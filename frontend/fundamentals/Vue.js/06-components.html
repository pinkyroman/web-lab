<html>
    <head>
        <title>Vue Components</title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.js"></script>
    </head>

    <body>
        <div id="app">
            <div class="container">
                <h1>Let's hear some stories!</h1>
                <ul class="list-group">
                    <!-- v-bind: 는 :로 축약해서 사용할 수 있다 -->
                    <story v-for="story in stories" v-bind:key="story.writer" :value="story" :favorite="favorite" @update="updateFavorite"></story>
                </ul>
            
                <!-- display data for debugging -->
                <pre>
                    <code>{{ $data }}</code>
                </pre>
            </div>
        </div>
    </body>

    <template id="story-template">
        <li class="list-group-item">
            {{ value.writer }} said "{{ value.plot }}".
            Story upvotes {{ value.upvotes }}.
            <button v-show="!value.voted" @click="upvote" class="btn btn-default">Upvote</button>
            <button v-show="!isFavorite" @click="makeFavorite" class="btn btn-primary">Favorite</button>
            <span v-show="isFavorite" class="glyphicon glyphicon-star pull-right" aria-hidden="true"></span>
        </li>
    </template>

    <script>
        Vue.component("story", {
            template: "#story-template",
            props: ["value", "favorite"],
            methods: {
                upvote: function () {                    
                    this.value.upvotes += 1;
                    this.value.voted = true;
                },
                makeFavorite: function() {
                    this.$emit("update", this.value);
                }
            },
            computed: {
                isFavorite: function () {
                    return this.value == this.favorite;
                }
            }
        });

        new Vue({
            el: "#app",
            data: {
                stories: [
                    {
                        plot: 'My horse is amzaing.',
                        writer: 'Mr. Weebl',
                        upvotes: 28,
                        voted: false,
                    },
                    {
                        plot: 'Narwhals invented Shish Kebab.',
                        writer: 'Mr.Weebl',
                        upvotes: 8,
                        voted: false,
                    },
                    {
                        plot: 'The dark side of the Force is stronger.',
                        writer: 'Darth Vader',
                        upvotes: 49,
                        voted: false,
                    },
                    {
                        plot: 'One does not simply walk into Mordor.',
                        writer: 'Boromir',
                        upvotes: 74,
                        voted: false,
                    }
                ],
                favorite: {},
            },
            methods: {
                updateFavorite: function (story) {
                    this.favorite = story;
                }
            }
        })
    </script>
</html>