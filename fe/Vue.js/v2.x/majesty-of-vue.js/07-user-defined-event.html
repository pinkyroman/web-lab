<html>
    <head>
        <title>Vue User-defined Events</title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.js"></script>
    </head>

    <body>
        <div class="container">
            <div class="container text-center">
                <p style="font-size: 140px">
                    {{ votes.count }}
                </p>
                <button class="btn btn-danger" @click="reset">Reset Votes</button>
                <button class="btn btn-warning" @click="stop">Stop Count</button>
                
                <div class="row">
                    <food @voted="countVote" name="Cheeseburger"></food>
                    <food @voted="countVote" name="Double Bacon Burger"></food>
                    <food @voted="countVote" name="Rodeo Burger"></food>
                </div>

                <h1>Log:</h1>
                <ul class="list-group">
                    <li class="list-group-item" v-for="log in votes.logs">
                        {{ log }}
                    </li>
                </ul>
            </div>
            

            <!-- display data for debugging -->
            <br><br><br>
            <pre>
                <code>
                    {{$data}}
                </code>
            </pre>
        </div>
    </body>

    <template id="food-template">
        <div class="text-center col-lg-4">
            <p style="font-size: 40px;">
                {{ votes }}
            </p>
            <button class="btn btn-default" @click="vote">{{ name }}</button>
        </div>
    </template>

    <script>
        // 중앙 집중식 이벤트 버스 역할을 하기위한 Vue 인스턴스
        var bus = new Vue();

        Vue.component("food", {
            template: "#food-template",
            props: ["name"],
            /*
                Vue Component의 data 옵션은 인스턴스 별 값을 반환하는 함수이어야 한다.
            */
            data: function () {
                return {
                    votes: 0,
                }
            },
            methods: {
                vote: function (e) {
                    console.log(e);
                    this.votes++;
                    // this.$emit("voted", e.srcElement.textContent);
                    bus.$emit("voted", e.srcElement.textContent);
                },
                reset: function () {
                    this.votes = 0;
                }
            },
            created() {
                bus.$on('reset', this.reset);
            }
        });

        new Vue({
            el: ".container",
            data: {
                votes: {
                    count: 0,
                    logs: [],
                }
            },
            methods: {
                countVote: function (food) {
                    this.votes.count++;
                    this.votes.logs.push(food + ' received a vote.');
                },
                reset: function () {
                    this.votes = {
                        count: 0,
                        logs: [],
                    }
                    bus.$emit("reset");
                },
                stop: function () {
                    this.reset();
                    // bus.$off(["voted"]);
                    bus.$off();
                }
            },
            created () {
                bus.$on("voted", this.countVote);
            }
        })
    </script>
</html>